#!/bin/bash

echo "üé¨ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Git Commit Template CLI"
echo "======================================="
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–µ–º–æ –ø—Ä–æ–µ–∫—Ç
cd demo/test-project

echo "üìÇ –ü–µ—Ä–µ—à–ª–∏ –≤ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç: $(pwd)"
echo ""

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º git –µ—Å–ª–∏ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
if [ ! -d ".git" ]; then
    echo "üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
    git init
    echo ""
fi

echo "üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ CLI:"
echo ""

echo "1Ô∏è‚É£ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É:"
echo "   > commit-template --help"
echo ""
node ../../bin/cli.js --help
echo ""

echo "2Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ (–≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ):"
echo "   > commit-template init --template default --skip-prompts"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ
echo "y" | node ../../bin/cli.js init --template default --skip-prompts

echo ""
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
echo ""

if [ -f "cz-config.js" ]; then
    echo "‚úÖ –§–∞–π–ª cz-config.js —Å–æ–∑–¥–∞–Ω"
    echo "üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ (–ø–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–æ–∫):"
    head -10 cz-config.js
    echo "..."
else
    echo "‚ùå –§–∞–π–ª cz-config.js –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""

if [ -f "package.json" ]; then
    echo "‚úÖ package.json –æ–±–Ω–æ–≤–ª–µ–Ω"
    if grep -q "commitizen" package.json; then
        echo "üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ commitizen –¥–æ–±–∞–≤–ª–µ–Ω—ã"
    fi
    if grep -q "commit.*cz" package.json; then
        echo "üîß –°–∫—Ä–∏–ø—Ç commit –¥–æ–±–∞–≤–ª–µ–Ω"
    fi
else
    echo "‚ùå package.json –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""

if [ -f ".git/hooks/commit-msg" ]; then
    echo "‚úÖ Git hook commit-msg –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    echo "ü™ù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:"
    cat .git/hooks/commit-msg | head -5
    echo "..."
else
    echo "‚ùå Git hook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
fi

echo ""
echo "4Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:"
echo ""

# –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –≤ git
git add .

echo "   > git add ."
echo "   > git commit -m 'feat/demo | #123 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞'"
echo ""

# –ü—ã—Ç–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç
if git commit -m "feat/demo | #123 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞" 2>/dev/null; then
    echo "‚úÖ –ö–æ–º–º–∏—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º!"
    echo ""
    echo "üìã –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤:"
    git log --oneline -3
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞"
fi

echo ""
echo "5Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:"
echo "   > git commit -m '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç'"
echo ""

# –°–æ–∑–¥–∞–µ–º –µ—â–µ –æ–¥–∏–Ω —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
echo "// –¢–µ—Å—Ç–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ" >> index.js
git add index.js

# –ü—ã—Ç–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
if git commit -m "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç" 2>&1 | grep -q "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç"; then
    echo "‚úÖ Git hook –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª–æ–Ω–∏–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç"
else
    echo "‚ùå Git hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª"
fi

echo ""
echo "üéâ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üí° –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ:"
echo "   1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ CLI: npm install -g git-commit-template-cli"
echo "   2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
echo "   3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: commit-template init"
echo "   4. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º"
echo ""
echo "üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ README.md" 